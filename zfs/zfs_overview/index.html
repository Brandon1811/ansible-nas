
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Build a fully functional NAS with an Ubuntu box and this playbook">
      
      
      
        <meta name="author" content="David Stephens">
      
      
        <link rel="canonical" href="https://davestephens.uk/ansible-nas/zfs/zfs_overview/">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.6">
    
    
      
        <title>ZFS Overview - Ansible-NAS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.39b8e14a.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
      <link rel="manifest" href="../../manifest.webmanifest" crossorigin="use-credentials">
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="indigo">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#zfs-overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://davestephens.uk/ansible-nas" title="Ansible-NAS" class="md-header-nav__button md-logo" aria-label="Ansible-NAS">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Ansible-NAS
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              ZFS Overview
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/davestephens/ansible-nas/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    davestephens/ansible-nas
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://davestephens.uk/ansible-nas" title="Ansible-NAS" class="md-nav__button md-logo" aria-label="Ansible-NAS">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Ansible-NAS
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/davestephens/ansible-nas/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    davestephens/ansible-nas
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/" class="md-nav__link">
        Hardware
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../post_installation/" class="md-nav__link">
        Post installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../support/" class="md-nav__link">
        Support
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../upgrading/" class="md-nav__link">
        Upgrading Ansible-NAS
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" >
      
      <label class="md-nav__link" for="nav-9">
        Applications
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Applications" data-md-level="1">
        <label class="md-nav__title" for="nav-9">
          <span class="md-nav__icon md-icon"></span>
          Applications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/airsonic/" class="md-nav__link">
        Airsonic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/bazarr/" class="md-nav__link">
        Bazarr subtitle downloader
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/bitwarden/" class="md-nav__link">
        Bitwarden(_rs) Password Management
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/calibre/" class="md-nav__link">
        Calibre-web
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/cloudcmd/" class="md-nav__link">
        Cloud Commander file manager
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/cloudflare_ddns/" class="md-nav__link">
        Cloudflare Dynamic DNS Updater
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/couchpotato/" class="md-nav__link">
        CouchPotato
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/deluge/" class="md-nav__link">
        Deluge
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/duplicati/" class="md-nav__link">
        Duplicati
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/emby/" class="md-nav__link">
        Emby
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/firefly/" class="md-nav__link">
        Firefly III
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/get_iplayer/" class="md-nav__link">
        get_iplayer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/gitea/" class="md-nav__link">
        Gitea
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/gitlab/" class="md-nav__link">
        GitLab
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/guacamole/" class="md-nav__link">
        Guacamole
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/heimdall/" class="md-nav__link">
        Heimdall
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/homeassistant/" class="md-nav__link">
        Home Assistant
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/homebridge/" class="md-nav__link">
        Homebridge
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/jackett/" class="md-nav__link">
        Jackett
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/jellyfin/" class="md-nav__link">
        Jellyfin
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/joomla/" class="md-nav__link">
        Joomla CMS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/krusader/" class="md-nav__link">
        Krusader
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/lidarr/" class="md-nav__link">
        Lidarr music collection manager
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/minidlna/" class="md-nav__link">
        MiniDLNA
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/miniflux/" class="md-nav__link">
        Miniflux
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/mosquitto/" class="md-nav__link">
        Mosquitto
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/mylar/" class="md-nav__link">
        Mylar
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/mymediaforalexa/" class="md-nav__link">
        My Media for Alexa
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/n8n/" class="md-nav__link">
        Nodemation (n8n)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/nextcloud/" class="md-nav__link">
        Nextcloud
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/nzbget/" class="md-nav__link">
        NZBget
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/ombi/" class="md-nav__link">
        Ombi
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/openhab/" class="md-nav__link">
        openHAB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/organizr/" class="md-nav__link">
        Organizr
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/pyload/" class="md-nav__link">
        pyLoad
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/pytivo/" class="md-nav__link">
        PyTivo
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/radarr/" class="md-nav__link">
        Radarr
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/sonarr/" class="md-nav__link">
        Sonarr
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/syncthing/" class="md-nav__link">
        Syncthing: Open Source Continuous File Synchronisation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/tautulli/" class="md-nav__link">
        Tautulli
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/thelounge/" class="md-nav__link">
        The Lounge
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/timemachine/" class="md-nav__link">
        Time Machine
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/traefik/" class="md-nav__link">
        Traefik
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/transmission/" class="md-nav__link">
        Transmission
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/ubooquity/" class="md-nav__link">
        Ubooquity Comic and Book Server
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/utorrent/" class="md-nav__link">
        uTorrent
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/virtual_desktop/" class="md-nav__link">
        Virtual Desktop
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/wallabag/" class="md-nav__link">
        wallabag
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/watchtower/" class="md-nav__link">
        Watchtower
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/youtubedlmaterial/" class="md-nav__link">
        YouTubeDL-Material
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" >
      
      <label class="md-nav__link" for="nav-10">
        Configuration
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Configuration" data-md-level="1">
        <label class="md-nav__title" for="nav-10">
          <span class="md-nav__icon md-icon"></span>
          Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/application_ports/" class="md-nav__link">
        Application Ports
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/custom_applications/" class="md-nav__link">
        Custom Applications
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/external_access/" class="md-nav__link">
        External Access
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/nfs_exports/" class="md-nav__link">
        NFS Exports
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/samba_shares/" class="md-nav__link">
        Samba Shares
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11" checked>
      
      <label class="md-nav__link" for="nav-11">
        Zfs
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Zfs" data-md-level="1">
        <label class="md-nav__title" for="nav-11">
          <span class="md-nav__icon md-icon"></span>
          Zfs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../zfs_configuration/" class="md-nav__link">
        ZFS Configuration
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          ZFS Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        ZFS Overview
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-zfs-and-why-would-i-want-it" class="md-nav__link">
    What is ZFS and why would I want it?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#an-overview-and-some-actual-commands" class="md-nav__link">
    An overview and some actual commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-issues" class="md-nav__link">
    Known issues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#myths-and-misunderstandings" class="md-nav__link">
    Myths and misunderstandings
  </a>
  
    <nav class="md-nav" aria-label="Myths and misunderstandings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-zfs-does-not-need-at-least-8-gb-of-ram" class="md-nav__link">
    No, ZFS does not need at least 8 GB of RAM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-ecc-ram-is-not-required-for-zfs" class="md-nav__link">
    No, ECC RAM is not required for ZFS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-the-slog-is-not-really-a-write-cache" class="md-nav__link">
    No, the SLOG is not really a write cache
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-reading-and-viewing" class="md-nav__link">
    Further reading and viewing
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-zfs-and-why-would-i-want-it" class="md-nav__link">
    What is ZFS and why would I want it?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#an-overview-and-some-actual-commands" class="md-nav__link">
    An overview and some actual commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-issues" class="md-nav__link">
    Known issues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#myths-and-misunderstandings" class="md-nav__link">
    Myths and misunderstandings
  </a>
  
    <nav class="md-nav" aria-label="Myths and misunderstandings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-zfs-does-not-need-at-least-8-gb-of-ram" class="md-nav__link">
    No, ZFS does not need at least 8 GB of RAM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-ecc-ram-is-not-required-for-zfs" class="md-nav__link">
    No, ECC RAM is not required for ZFS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-the-slog-is-not-really-a-write-cache" class="md-nav__link">
    No, the SLOG is not really a write cache
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-reading-and-viewing" class="md-nav__link">
    Further reading and viewing
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/davestephens/ansible-nas/edit/master/docs/zfs/zfs_overview.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="zfs-overview">ZFS Overview</h1>
<p>This is a general overview of the ZFS file system for people who are new to it.
If you have some experience and are actually looking for specific information
about how to configure ZFS for Ansible-NAS, check out the <a href="../zfs_configuration/">ZFS example
configuration</a>.  </p>
<h2 id="what-is-zfs-and-why-would-i-want-it">What is ZFS and why would I want it?</h2>
<p><a href="https://en.wikipedia.org/wiki/ZFS">ZFS</a> is an advanced filesystem and volume
manager originally created by Sun Microsystems starting in 2001. First released
in 2005 for OpenSolaris, Oracle later bought Sun and switched to developing ZFS
as closed source software. An open source fork took the name
<a href="http://www.open-zfs.org/wiki/Main_Page">OpenZFS</a>, but is still called "ZFS" for
short. It runs on Linux, FreeBSD, illumos and other platforms.</p>
<p>ZFS aims to be the <a href="https://blogs.oracle.com/bonwick/zfs:-the-last-word-in-filesystems">"last word in
filesystems"</a>,
a technology so future-proof that Michael W. Lucas and Allan Jude famously
stated that the <em>Enterprise's</em> computer on <em>Star Trek</em> probably runs it. The
design was based on <a href="https://www.youtube.com/watch?v=MsY-BafQgj4">four
principles</a>:</p>
<ol>
<li>
<p>"Pooled" storage to eliminate the notion of volumes. You can add more storage
   the same way you just add a RAM stick to memory.</p>
</li>
<li>
<p>Make sure data is always consistent on the disks. There is no <code>fsck</code> command
   for ZFS and none is needed.</p>
</li>
<li>
<p>Detect and correct data corruption ("bitrot"). ZFS is one of the few storage
   systems that checksums everything, including the data itself, and is
   "self-healing".</p>
</li>
<li>
<p>Make it easy to use. Try to "end the suffering" for the admins involved in
   managing storage.</p>
</li>
</ol>
<p>ZFS includes a host of other features such as snapshots, transparent compression
and encryption. During the early years of ZFS, this all came with hardware
requirements only enterprise users could afford. By now, however, computers have
become so powerful that ZFS can run (with some effort) on a <a href="https://gist.github.com/mohakshah/b203d33a235307c40065bdc43e287547">Raspberry
Pi</a>. </p>
<p>FreeBSD and FreeNAS make extensive use of ZFS. What is holding ZFS back on Linux
are <a href="https://en.wikipedia.org/wiki/OpenZFS#History">licensing issues</a> beyond the
scope of this document. </p>
<p>Ansible-NAS doesn't actually specify a filesystem - you can use EXT4, XFS or
Btrfs as well. However, ZFS not only provides the benefits listed above, but
also lets you use your hard drives with different operating systems. Some people
now using Ansible-NAS came from FreeNAS, and were able to <code>export</code> their ZFS
storage drives there and <code>import</code> them to Ubuntu. On the other hand, if you ever
decide to switch back to FreeNAS or maybe want to use FreeBSD instead of Linux,
you should be able to use the same ZFS pools. </p>
<h2 id="an-overview-and-some-actual-commands">An overview and some actual commands</h2>
<p>Storage in ZFS is organized in <strong>pools</strong>. Inside these pools, you create
<strong>filesystems</strong> (also known as "datasets") which are like partitions on
steroids. For instance, you can keep each user's <code>/home</code> directory in a separate
filesystem. ZFS systems tend to use lots and lots of specialized filesystems
with tailored parameters such as record size and compression. All filesystems
share the available storage in their pool. </p>
<p>Pools do not directly consist of hard disks or SSDs. Instead, drives are
organized as <strong>virtual devices</strong> (VDEVs). This is where the physical redundancy
in ZFS is located. Drives in a VDEV can be "mirrored" or combined as "RaidZ",
roughly the equivalent of RAID5. These VDEVs are then combined into a pool by the
administrator. The command might look something like this:</p>
<pre><code>        sudo zpool create tank mirror /dev/sda /dev/sdb
</code></pre>
<p>This combines <code>/dev/sba</code> and <code>/dev/sdb</code> to a mirrored VDEV, and then defines a
new pool named <code>tank</code> consisting of this single VDEV. (Actually, you'd want to
use a different ID for the drives, but you get the idea.) You can now create a
filesystem in this pool for, say, all of your <em>Mass Effect</em> fan fiction: </p>
<pre><code>        sudo zfs create tank/mefanfic
</code></pre>
<p>You can then enable automatic compression on this filesystem with <code>sudo zfs set
compression=lz4 tank/mefanfic</code>. To take a <strong>snapshot</strong>, use</p>
<pre><code>        sudo zfs snapshot tank/mefanfic@21540411
</code></pre>
<p>Now, if evil people were somehow able to encrypt your precious fan fiction files
with ransomware, you can simply laugh maniacally and revert to the old version: </p>
<pre><code>        sudo zfs rollback tank/mefanfic@21540411
</code></pre>
<p>Of course, you would lose any texts you might have added to the filesystem
between that snapshot and now. Usually, you'll have some form of <strong>automatic
snapshot administration</strong> configured.</p>
<p>To detect bitrot and other data defects, ZFS periodically runs <strong>scrubs</strong>: The
system compares the available copies of each data record with their checksums.
If there is a mismatch, the data is repaired.</p>
<h2 id="known-issues">Known issues</h2>
<blockquote>
<p>At time of writing (April 2019), ZFS on Linux does not offer native
encryption, TRIM support or device removal, which are all scheduled to be
included in the upcoming <a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=ZFS-On-Linux-0.8-RC1-Released">0.8
release</a>
any day now.</p>
</blockquote>
<p>ZFS' original design for enterprise systems and redundancy requirements can make
some things difficult. You can't just add individual drives to a pool and tell
the system to reconfigure automatically. Instead, you have to either add a new
VDEV, or replace each of the existing drives with one of higher capacity. In an
enterprise environment, of course, you would just <em>buy</em> a bunch of new drives
and move the data from the old pool to the new pool. Shrinking a pool is even
harder - put simply, ZFS is not built for this, though it is <a href="https://www.delphix.com/blog/delphix-engineering/openzfs-device-removal">being worked
on</a>. </p>
<p>If you absolutely must be able to add or remove single drives, ZFS might not be
the filesystem for you. </p>
<h2 id="myths-and-misunderstandings">Myths and misunderstandings</h2>
<p>Information on the internet about ZFS can be outdated, conflicting or flat-out
wrong. Partially this is because it has been in use for almost 15 years now and
things change, partially it is the result of being used on different operating
systems which have minor differences under the hood. Also, Google searches tend
to first return the Oracle documentation for their closed source ZFS variant,
which is increasingly diverging from the open source OpenZFS standard.</p>
<p>To clear up some of the most common misunderstandings:</p>
<h3 id="no-zfs-does-not-need-at-least-8-gb-of-ram">No, ZFS does not need at least 8 GB of RAM</h3>
<p>This myth is especially common <a href="https://www.ixsystems.com/community/threads/does-freenas-really-need-8gb-of-ram.38685/">in FreeNAS
circles</a>.
Curiously, FreeBSD, the basis of FreeNAS, will run with <a href="https://wiki.freebsd.org/ZFSTuningGuide">1
GB</a>. The <a href="https://github.com/zfsonlinux/zfs/wiki/FAQ#hardware-requirements">ZFS on Linux
FAQ</a>, which is
more relevant for Ansible-NAS, states under "suggested hardware":</p>
<blockquote>
<p>8GB+ of memory for the best performance. It's perfectly possible to run with
2GB or less (and people do), but you'll need more if using deduplication.</p>
</blockquote>
<p>(Deduplication is only useful in <a href="http://open-zfs.org/wiki/Performance_tuning#Deduplication">special
cases</a>. If you are
reading this, you probably don't need it.)</p>
<p>Experience shows that 8 GB of RAM is in fact a sensible minimal amount for
continuous use. But it's not a requirement. What everybody agrees on is that ZFS
<em>loves</em> RAM and works better the more it has, so you should have as much of it
as you possibly can. When in doubt, add more RAM, and even more, and them some,
until your motherboard's capacity is reached.</p>
<h3 id="no-ecc-ram-is-not-required-for-zfs">No, ECC RAM is not required for ZFS</h3>
<p>This is another case where a recommendation has been taken as a requirement. To
quote the <a href="https://github.com/zfsonlinux/zfs/wiki/FAQ#do-i-have-to-use-ecc-memory-for-zfs">ZFS on Linux
FAQ</a>
again: </p>
<blockquote>
<p>Using ECC memory for OpenZFS is strongly recommended for enterprise
environments where the strongest data integrity guarantees are required.
Without ECC memory rare random bit flips caused by cosmic rays or by faulty
memory can go undetected. If this were to occur OpenZFS (or any other
filesystem) will write the damaged data to disk and be unable to automatically
detect the corruption.</p>
</blockquote>
<p>ECC corrects <a href="https://en.wikipedia.org/wiki/ECC_memory">single bit errors</a> in
memory. It is <em>always</em> better to have it on <em>any</em> computer if you can afford it,
and ZFS is no exception. However, there is absolutely no requirement for ZFS to
have ECC RAM. If you just don't care about the danger of random bit flips
because, hey, you can always just download <a href="https://archive.org/details/night_of_the_living_dead">Night of the Living
Dead</a> all over again,
you're perfectly free to use normal RAM. If you do use ECC RAM, make sure your
processor and motherboard support it.</p>
<h3 id="no-the-slog-is-not-really-a-write-cache">No, the SLOG is not really a write cache</h3>
<p>You'll read the suggestion to add a fast SSD or NVMe as a "SLOG drive"
(mistakenly also called "ZIL") for write caching. This isn't what happens,
because ZFS already includes <a href="https://linuxhint.com/configuring-zfs-cache/">a write
cache</a> in RAM. Since RAM is always
faster, adding a disk as a write cache doesn't even make sense. </p>
<p>What the <strong>ZFS Intent Log (ZIL)</strong> does, with or without a dedicated drive, is handle
synchronous writes. These occur when the system refuses to signal a successful
write until the data is actually stored on a physical disk somewhere. This keeps
the data safe, but is slower. </p>
<p>By default, the ZIL initially shoves a copy of the data on a normal VDEV
somewhere and then gives the thumbs up. The actual write to the pool is
performed later from the write cache in RAM, <em>not</em> the temporary copy. The data
there is only ever read if the power fails before the last step. The ZIL is all
about protecting data, not making transfers faster.</p>
<p>A <strong>Separate Intent Log (SLOG)</strong> is an additional fast drive for these temporary
synchronous writes. It simply allows the ZIL give the thumbs up quicker. This
means that a SLOG is never read unless the power has failed before the final
write to the pool. </p>
<p>Asynchronous writes just go through the normal write cache, by the way. If the
power fails, the data is gone.</p>
<p>In summary, the ZIL prevents data loss during synchronous writes, or at least
ensures that the data in storage is consistent. You always have a ZIL. A SLOG
will make the ZIL faster. You'll probably need to <a href="https://www.ixsystems.com/blog/o-slog-not-slog-best-configure-zfs-intent-log/">do some
research</a>
and some testing to figure out if your system would benefit from a SLOG. NFS for
instance uses synchronous writes, SMB usually doesn't. When in doubt, add more
RAM instead. </p>
<h2 id="further-reading-and-viewing">Further reading and viewing</h2>
<ul>
<li>
<p>In 2012, Aaron Toponce wrote a now slightly dated, but still very good
  <a href="https://pthree.org/2012/04/17/install-zfs-on-debian-gnulinux/">introduction</a>
  to ZFS on Linux. If you only read one part, make it the <a href="https://pthree.org/2012/12/07/zfs-administration-part-iv-the-adjustable-replacement-cache/">explanation of the
  ARC</a>,
  ZFS' read cache. </p>
</li>
<li>
<p>One of the best books on ZFS around is <em>FreeBSD Mastery: ZFS</em> by Michael W.
  Lucas and Allan Jude. Though it is written for FreeBSD, the general guidelines
  apply for all variants. There is a second volume for advanced use.</p>
</li>
<li>
<p>Jeff Bonwick, one of the original creators of ZFS, tells the story of how ZFS
  came to be <a href="https://www.youtube.com/watch?v=dcV2PaMTAJ4">on YouTube</a>.</p>
</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../zfs_configuration/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                ZFS Configuration
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 - 2020 David Stephens
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/davestephens" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.53cc9318.min.js"></script>
      <script src="../../assets/javascripts/bundle.e9c9f54f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>